generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Approval {
  id            String    @id
  operationId   String
  approverRole  String
  approverId    String?
  approverName  String?
  status        String    @default("pending")
  notes         String?
  actionTakenAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  Operation     Operation @relation(fields: [operationId], references: [id], onDelete: Cascade)

  @@index([approverRole])
  @@index([operationId])
  @@index([status])
}

model ApprovalRule {
  id             String   @id
  module         String
  conditionField String
  operator       String
  threshold      Float
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([isActive])
  @@index([module])
}

model Asset {
  id                    String             @id
  assetTag              String             @unique
  name                  String
  description           String?
  categoryId            String
  brand                 String?
  modelNumber           String?
  serialNumber          String?
  status                String             @default("ACTIVE")
  purchaseDate          DateTime
  purchasePrice         Float
  supplier              String?
  invoiceNumber         String?
  invoiceDocument       String?
  warrantyStartDate     DateTime?
  warrantyEndDate       DateTime?
  warrantyTerms         String?
  technicalSpecs        Json?
  assignedToUserId      String?
  assignedToTeam        String?
  assignedToProject     String?
  assignmentDate        DateTime?
  disposalDate          DateTime?
  disposalMethod        String?
  disposalValue         Float?
  disposalNotes         String?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime
  createdBy             String?
  updatedBy             String?
  imageUrl              String?
  lifespanUnit          String?
  lifespanValue         Int?
  warrantyProvider      String?
  warrantyDurationUnit  String?
  warrantyDurationValue Int?
  locationId            String?
  supplierId            String?
  productUrl            String?
  technicalManualUrl    String?
  AssetCategory         AssetCategory      @relation(fields: [categoryId], references: [id])
  AssetLocation         AssetLocation?     @relation(fields: [locationId], references: [id])
  Supplier              Supplier?          @relation(fields: [supplierId], references: [id])
  AssetAssignment       AssetAssignment[]
  AssetDocument         AssetDocument[]
  AssetMaintenance      AssetMaintenance[]
  AssetTransfer         AssetTransfer[]

  @@index([assetTag])
  @@index([assignedToUserId])
  @@index([categoryId])
  @@index([locationId])
  @@index([purchaseDate])
  @@index([status])
  @@index([supplierId])
}

model AssetAssignment {
  id                String    @id
  assetId           String
  assignedToUserId  String?
  assignedToTeam    String?
  assignedToProject String?
  assignedBy        String?
  assignmentDate    DateTime  @default(now())
  returnDate        DateTime?
  notes             String?
  createdAt         DateTime  @default(now())
  Asset             Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([assignedToUserId])
  @@index([assignmentDate])
}

model AssetCategory {
  id                  String          @id
  name                String
  description         String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  code                String          @unique
  parentId            String?
  Asset               Asset[]
  AssetCategory       AssetCategory?  @relation("AssetCategoryToAssetCategory", fields: [parentId], references: [id], onDelete: Cascade)
  other_AssetCategory AssetCategory[] @relation("AssetCategoryToAssetCategory")

  @@unique([name, parentId])
  @@index([code])
  @@index([name])
  @@index([parentId])
}

model AssetDocument {
  id           String   @id
  assetId      String
  documentType String
  title        String
  description  String?
  fileUrl      String
  fileName     String
  fileSize     Int?
  mimeType     String?
  uploadedAt   DateTime @default(now())
  uploadedBy   String?
  Asset        Asset    @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([documentType])
}

model AssetLocation {
  id                                                        String          @id
  name                                                      String          @unique
  code                                                      String          @unique
  type                                                      String
  address                                                   String?
  description                                               String?
  contactPerson                                             String?
  contactPhone                                              String?
  isActive                                                  Boolean         @default(true)
  createdAt                                                 DateTime        @default(now())
  updatedAt                                                 DateTime
  Asset                                                     Asset[]
  AssetTransfer_AssetTransfer_fromLocationIdToAssetLocation AssetTransfer[] @relation("AssetTransfer_fromLocationIdToAssetLocation")
  AssetTransfer_AssetTransfer_toLocationIdToAssetLocation   AssetTransfer[] @relation("AssetTransfer_toLocationIdToAssetLocation")

  @@index([code])
  @@index([isActive])
  @@index([name])
  @@index([type])
}

model AssetMaintenance {
  id              String    @id
  assetId         String
  maintenanceType String
  scheduledDate   DateTime?
  completedDate   DateTime?
  nextDueDate     DateTime?
  description     String
  performedBy     String?
  cost            Float?
  laborHours      Float?
  downtime        Float?
  partsUsed       Json?
  status          String    @default("SCHEDULED")
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  createdBy       String?
  Asset           Asset     @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
  @@index([nextDueDate])
  @@index([scheduledDate])
  @@index([status])
}

model AssetTransfer {
  id                                                        String                 @id
  transferNumber                                            String                 @unique
  assetId                                                   String
  fromLocationId                                            String
  toLocationId                                              String
  status                                                    String                 @default("PENDING")
  transferDate                                              DateTime               @default(now())
  expectedArrival                                           DateTime?
  actualArrival                                             DateTime?
  reason                                                    String?
  notes                                                     String?
  requestedById                                             String
  requestedByName                                           String
  approvedById                                              String?
  approvedByName                                            String?
  approvedAt                                                DateTime?
  completedById                                             String?
  completedByName                                           String?
  completedAt                                               DateTime?
  conditionBefore                                           String?
  conditionAfter                                            String?
  createdAt                                                 DateTime               @default(now())
  updatedAt                                                 DateTime
  Asset                                                     Asset                  @relation(fields: [assetId], references: [id], onDelete: Cascade)
  AssetLocation_AssetTransfer_fromLocationIdToAssetLocation AssetLocation          @relation("AssetTransfer_fromLocationIdToAssetLocation", fields: [fromLocationId], references: [id])
  AssetLocation_AssetTransfer_toLocationIdToAssetLocation   AssetLocation          @relation("AssetTransfer_toLocationIdToAssetLocation", fields: [toLocationId], references: [id])
  AssetTransferHistory                                      AssetTransferHistory[]

  @@index([assetId])
  @@index([fromLocationId])
  @@index([status])
  @@index([toLocationId])
  @@index([transferDate])
  @@index([transferNumber])
}

model AssetTransferHistory {
  id              String        @id
  transferId      String
  action          String
  performedById   String
  performedByName String
  notes           String?
  timestamp       DateTime      @default(now())
  createdAt       DateTime      @default(now())
  AssetTransfer   AssetTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@index([timestamp])
  @@index([transferId])
}

model Comment {
  id        String   @id
  content   String
  designId  String
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [authorId], references: [id])
  Design    Design   @relation(fields: [designId], references: [id])
}

model Design {
  id        String    @id
  name      String
  content   Json
  thumbnail String?
  projectId String
  creatorId String
  createdAt DateTime  @default(now())
  updatedAt DateTime
  Comment   Comment[]
  User      User      @relation(fields: [creatorId], references: [id])
  Project   Project   @relation(fields: [projectId], references: [id])
}

model DryingProcess {
  id                       String                @id
  batchNumber              String                @unique
  woodTypeId               String?
  thickness                Float?
  pieceCount               Int?
  startTime                DateTime
  endTime                  DateTime?
  status                   String                @default("IN_PROGRESS")
  totalCost                Float?
  notes                    String?
  createdAt                DateTime              @default(now())
  updatedAt                DateTime
  startingHumidity         Float?
  startingElectricityUnits Float?
  thicknessUnit            String?               @default("mm")
  sourceWarehouseId        String?
  stockThickness           String?
  useStock                 Boolean               @default(false)
  createdById              String?
  createdByName            String?
  Warehouse                Warehouse?            @relation(fields: [sourceWarehouseId], references: [id])
  WoodType                 WoodType?             @relation(fields: [woodTypeId], references: [id])
  DryingProcessItem        DryingProcessItem[]
  DryingReading            DryingReading[]
  ElectricityRecharge      ElectricityRecharge[]

  @@index([batchNumber])
  @@index([createdById])
  @@index([sourceWarehouseId])
  @@index([startTime])
  @@index([status])
  @@index([woodTypeId])
}

model DryingProcessItem {
  id                String        @id
  dryingProcessId   String
  woodTypeId        String
  thickness         String
  pieceCount        Int
  sourceWarehouseId String
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  DryingProcess     DryingProcess @relation(fields: [dryingProcessId], references: [id], onDelete: Cascade)
  Warehouse         Warehouse     @relation(fields: [sourceWarehouseId], references: [id])
  WoodType          WoodType      @relation(fields: [woodTypeId], references: [id])

  @@index([dryingProcessId])
  @@index([sourceWarehouseId])
  @@index([woodTypeId])
}

model DryingReading {
  id                    String        @id
  dryingProcessId       String
  readingTime           DateTime      @default(now())
  electricityMeter      Float
  humidity              Float
  notes                 String?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime
  createdById           String?
  createdByName         String?
  updatedById           String?
  updatedByName         String?
  humidityMeterImageUrl String?
  lukuMeterImageUrl     String?
  ocrConfidence         Float?
  photoTimestamp        DateTime?
  source                String?       @default("MANUAL")
  DryingProcess         DryingProcess @relation(fields: [dryingProcessId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([dryingProcessId])
  @@index([readingTime])
  @@index([source])
}

model ElectricityRecharge {
  id                String         @id
  rechargeDate      DateTime
  token             String
  kwhAmount         Float
  totalPaid         Float
  baseCost          Float?
  vat               Float?
  ewuraFee          Float?
  reaFee            Float?
  debtCollected     Float?
  notes             String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime
  dryingProcessId   String?
  meterReadingAfter Float?
  DryingProcess     DryingProcess? @relation(fields: [dryingProcessId], references: [id], onDelete: Cascade)

  @@index([dryingProcessId])
  @@index([rechargeDate])
}

model Factory {
  id        String   @id
  name      String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id])
}

model Job {
  id        String   @id
  name      String
  status    String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model LotCost {
  id                    String   @id
  lotNumber             String   @unique
  otherExpenses         Float?
  notes                 String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime
  purchasePrice         Float?
  slicingExpenses       Float?
  transportPrice        Float?
  otherExpensesType     String   @default("LUMPSUM")
  purchasePriceType     String   @default("LUMPSUM")
  slicingExpensesType   String   @default("LUMPSUM")
  transportPriceType    String   @default("LUMPSUM")
  otherExpensesIncVat   Boolean  @default(false)
  purchasePriceIncVat   Boolean  @default(false)
  slicingExpensesIncVat Boolean  @default(false)
  transportPriceIncVat  Boolean  @default(false)

  @@index([lotNumber])
}

model NewsletterSubscriber {
  id             String    @id
  email          String    @unique
  source         String    @default("coming-soon")
  status         String    @default("active")
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?

  @@index([email])
  @@index([status])
  @@index([subscribedAt])
}

model Notification {
  id        String    @id
  userId    String
  type      String
  title     String
  message   String
  linkUrl   String?
  isRead    Boolean   @default(false)
  createdAt DateTime  @default(now())
  readAt    DateTime?

  @@index([createdAt])
  @@index([isRead])
  @@index([userId])
  @@index([userId, isRead])
}

model NotificationEventType {
  id          String   @id
  code        String   @unique
  name        String
  description String
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([category])
  @@index([isActive])
}

model NotificationSubscription {
  id        String   @id
  userId    String
  eventType String
  createdAt DateTime @default(now())
  updatedAt DateTime
  email     Boolean  @default(false)
  inApp     Boolean  @default(true)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, eventType])
  @@index([eventType])
  @@index([userId])
}

model Operation {
  id              String     @id
  serialNumber    String     @unique
  woodTypeId      String
  lotNumber       String
  startTime       DateTime?
  endTime         DateTime?
  sleeperSizes    Json
  plankSizes      Json
  status          String     @default("draft")
  wastePercentage Float?
  notes           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  sleeperNumber   Int?
  Approval        Approval[]
  WoodType        WoodType   @relation(fields: [woodTypeId], references: [id])

  @@index([createdAt])
  @@index([lotNumber])
  @@index([sleeperNumber])
  @@index([status])
  @@index([woodTypeId])
}

model Project {
  id          String   @id
  name        String
  description String?
  ownerId     String
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  Design      Design[]
  User        User     @relation(fields: [ownerId], references: [id])
}

model ReceiptDraft {
  id              String   @id @default(uuid())
  receiptId       String
  measurements    Json
  updatedAt       DateTime @default(now()) @updatedAt
  updatedBy       String
  createdAt       DateTime @default(now())
  measurementUnit String?  @default("imperial")

  @@index([receiptId])
}

model ReceiptHistory {
  id        String   @id @default(uuid())
  receiptId String
  userId    String
  userName  String
  action    String
  details   String
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())

  @@index([receiptId])
  @@index([timestamp])
}

model Setting {
  id        String   @id
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model SleeperMeasurement {
  id              String      @id
  receiptId       String
  thickness       Float
  width           Float
  length          Float
  qty             Int
  volumeM3        Float
  isCustom        Boolean     @default(false)
  isComplimentary Boolean     @default(false)
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  WoodReceipt     WoodReceipt @relation(fields: [receiptId], references: [id], onDelete: Cascade)

  @@index([receiptId])
  @@index([isComplimentary])
}

model Stock {
  id                 String    @id
  warehouseId        String
  woodTypeId         String
  thickness          String
  statusNotDried     Int       @default(0)
  statusUnderDrying  Int       @default(0)
  statusDried        Int       @default(0)
  statusDamaged      Int       @default(0)
  statusInTransitOut Int       @default(0)
  statusInTransitIn  Int       @default(0)
  minimumStockLevel  Int?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  Warehouse          Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  WoodType           WoodType  @relation(fields: [woodTypeId], references: [id])

  @@unique([warehouseId, woodTypeId, thickness])
  @@index([warehouseId])
  @@index([woodTypeId])
}

model StockAdjustment {
  id             String           @id
  warehouseId    String
  woodTypeId     String
  thickness      String
  woodStatus     WoodStatus
  quantityBefore Int
  quantityAfter  Int
  quantityChange Int
  reason         AdjustmentReason
  notes          String?
  adjustedById   String
  adjustedAt     DateTime         @default(now())
  createdAt      DateTime         @default(now())
  User           User             @relation(fields: [adjustedById], references: [id])
  Warehouse      Warehouse        @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  WoodType       WoodType         @relation(fields: [woodTypeId], references: [id])

  @@index([adjustedAt])
  @@index([adjustedById])
  @@index([warehouseId])
  @@index([woodTypeId])
}

model Supplier {
  id            String   @id
  name          String   @unique
  code          String?  @unique
  contactPerson String?
  email         String?
  phone         String?
  address       String?
  website       String?
  notes         String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  Asset         Asset[]

  @@index([code])
  @@index([isActive])
  @@index([name])
}

model TelegramButton {
  id                   String               @id
  layoutId             String
  text                 String
  callbackData         String
  url                  String?
  row                  Int
  column               Int
  order                Int
  isActive             Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime
  TelegramButtonLayout TelegramButtonLayout @relation(fields: [layoutId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([layoutId])
  @@index([order])
}

model TelegramButtonLayout {
  id             String           @id
  messageKey     String           @unique
  name           String
  description    String?
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  TelegramButton TelegramButton[]

  @@index([isActive])
  @@index([messageKey])
}

model TelegramMessage {
  id          String   @id
  key         String   @unique
  name        String
  content     String
  description String?
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  updatedBy   String?
  buttons     Json?

  @@index([category])
  @@index([isActive])
  @@index([key])
}

model TelegramSetting {
  id          String   @id
  key         String   @unique
  value       String
  type        String
  name        String
  description String?
  category    String
  isEditable  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  updatedBy   String?

  @@index([category])
  @@index([key])
}

model Transfer {
  id                                            String            @id
  transferNumber                                String            @unique
  fromWarehouseId                               String
  toWarehouseId                                 String
  status                                        TransferStatus    @default(PENDING)
  transferDate                                  DateTime          @default(now())
  notes                                         String?
  createdById                                   String
  approvedById                                  String?
  approvedAt                                    DateTime?
  completedAt                                   DateTime?
  createdAt                                     DateTime          @default(now())
  updatedAt                                     DateTime
  User_Transfer_approvedByIdToUser              User?             @relation("Transfer_approvedByIdToUser", fields: [approvedById], references: [id])
  User_Transfer_createdByIdToUser               User              @relation("Transfer_createdByIdToUser", fields: [createdById], references: [id])
  Warehouse_Transfer_fromWarehouseIdToWarehouse Warehouse         @relation("Transfer_fromWarehouseIdToWarehouse", fields: [fromWarehouseId], references: [id])
  Warehouse_Transfer_toWarehouseIdToWarehouse   Warehouse         @relation("Transfer_toWarehouseIdToWarehouse", fields: [toWarehouseId], references: [id])
  TransferHistory                               TransferHistory[]
  TransferItem                                  TransferItem[]

  @@index([createdById])
  @@index([fromWarehouseId])
  @@index([status])
  @@index([toWarehouseId])
  @@index([transferDate])
  @@index([transferNumber])
}

model TransferHistory {
  id             String   @id
  transferId     String
  transferNumber String
  userId         String
  userName       String
  userEmail      String
  action         String
  details        String?
  timestamp      DateTime @default(now())
  createdAt      DateTime @default(now())
  Transfer       Transfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([timestamp])
  @@index([transferId])
  @@index([transferNumber])
}

model TransferItem {
  id         String     @id
  transferId String
  woodTypeId String
  thickness  String
  quantity   Int
  woodStatus WoodStatus @default(NOT_DRIED)
  remarks    String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  Transfer   Transfer   @relation(fields: [transferId], references: [id], onDelete: Cascade)
  WoodType   WoodType   @relation(fields: [woodTypeId], references: [id])

  @@index([transferId])
  @@index([woodTypeId])
}

model User {
  id                                   String                     @id
  email                                String                     @unique
  password                             String
  firstName                            String?
  lastName                             String?
  role                                 String                     @default("user")
  isActive                             Boolean                    @default(true)
  createdAt                            DateTime                   @default(now())
  updatedAt                            DateTime
  accountLockedAt                      DateTime?
  failedLoginAttempts                  Int                        @default(0)
  lastFailedLoginAt                    DateTime?
  permissions                          Json?
  Comment                              Comment[]
  Design                               Design[]
  Factory                              Factory[]
  NotificationSubscription             NotificationSubscription[]
  Project                              Project[]
  StockAdjustment                      StockAdjustment[]
  Transfer_Transfer_approvedByIdToUser Transfer[]                 @relation("Transfer_approvedByIdToUser")
  Transfer_Transfer_createdByIdToUser  Transfer[]                 @relation("Transfer_createdByIdToUser")
  WarehouseUser                        WarehouseUser[]
  WoodCalculation                      WoodCalculation[]
}

model Warehouse {
  id                                           String              @id
  code                                         String              @unique
  name                                         String
  address                                      String?
  contactPerson                                String?
  stockControlEnabled                          Boolean             @default(false)
  requiresApproval                             Boolean             @default(false)
  status                                       WarehouseStatus     @default(ACTIVE)
  createdAt                                    DateTime            @default(now())
  updatedAt                                    DateTime
  DryingProcess                                DryingProcess[]
  DryingProcessItem                            DryingProcessItem[]
  Stock                                        Stock[]
  StockAdjustment                              StockAdjustment[]
  Transfer_Transfer_fromWarehouseIdToWarehouse Transfer[]          @relation("Transfer_fromWarehouseIdToWarehouse")
  Transfer_Transfer_toWarehouseIdToWarehouse   Transfer[]          @relation("Transfer_toWarehouseIdToWarehouse")
  WarehouseUser                                WarehouseUser[]
  WoodReceipt                                  WoodReceipt[]
  stock_movements                              stock_movements[]

  @@index([code])
  @@index([status])
}

model WarehouseUser {
  id          String    @id
  warehouseId String
  userId      String
  createdAt   DateTime  @default(now())
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  Warehouse   Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)

  @@unique([warehouseId, userId])
  @@index([userId])
  @@index([warehouseId])
}

model WebsiteFile {
  id            String         @id
  name          String
  originalName  String
  fileName      String
  mimeType      String
  size          Int
  path          String
  url           String
  uploadedAt    DateTime       @default(now())
  uploadedBy    String?
  folderId      String?
  WebsiteFolder WebsiteFolder? @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@index([folderId])
  @@index([uploadedAt])
  @@index([uploadedBy])
}

model WebsiteFolder {
  id                  String          @id
  name                String
  parentId            String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  createdBy           String?
  WebsiteFile         WebsiteFile[]
  WebsiteFolder       WebsiteFolder?  @relation("WebsiteFolderToWebsiteFolder", fields: [parentId], references: [id], onDelete: Cascade)
  other_WebsiteFolder WebsiteFolder[] @relation("WebsiteFolderToWebsiteFolder")

  @@index([createdBy])
  @@index([parentId])
}

model WebsitePage {
  id        String   @id
  name      String
  slug      String   @unique
  content   Json
  status    String   @default("draft")
  createdAt DateTime @default(now())
  updatedAt DateTime
  createdBy String?
  updatedBy String?

  @@index([slug])
  @@index([status])
}

model WoodCalculation {
  id            String   @id
  userId        String
  woodTypeId    String
  thickness     Float
  width         Float
  length        Float
  pricePerPlank Float
  volumeM3      Float
  planksPerM3   Float
  pricePerM3    Float
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  User          User     @relation(fields: [userId], references: [id])
  WoodType      WoodType @relation(fields: [woodTypeId], references: [id])
}

model WoodReceipt {
  id                 String               @id
  woodTypeId         String
  supplier           String
  receiptDate        DateTime
  purchaseOrder      String?
  status             String               @default("CREATED")
  notes              String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  lotNumber          String               @unique
  actualPieces       Int?
  actualVolumeM3     Float?
  estimatedAmount    Float                @default(0)
  estimatedPieces    Int?
  estimatedVolumeM3  Float?
  receiptConfirmedAt DateTime?
  woodFormat         String               @default("SLEEPERS")
  warehouseId        String?
  measurementUnit    String               @default("imperial")
  SleeperMeasurement SleeperMeasurement[]
  Warehouse          Warehouse?           @relation(fields: [warehouseId], references: [id])
  WoodType           WoodType             @relation(fields: [woodTypeId], references: [id])

  @@index([createdAt])
  @@index([lotNumber])
  @@index([status])
  @@index([warehouseId])
  @@index([woodTypeId])
}

model WoodType {
  id                String              @id
  name              String
  description       String?
  density           Float?
  grade             String
  origin            String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  DryingProcess     DryingProcess[]
  DryingProcessItem DryingProcessItem[]
  Operation         Operation[]
  Stock             Stock[]
  StockAdjustment   StockAdjustment[]
  TransferItem      TransferItem[]
  WoodCalculation   WoodCalculation[]
  WoodReceipt       WoodReceipt[]
  stock_movements   stock_movements[]
}

model stock_movements {
  id              String        @id
  createdAt       DateTime      @default(now())
  warehouseId     String
  woodTypeId      String
  thickness       String
  movementType    MovementType
  quantityChange  Int
  fromStatus      WoodStatus?
  toStatus        WoodStatus?
  referenceType   ReferenceType
  referenceId     String
  referenceNumber String?
  userId          String?
  userName        String?
  details         String?
  Warehouse       Warehouse     @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
  WoodType        WoodType      @relation(fields: [woodTypeId], references: [id])

  @@index([createdAt])
  @@index([movementType])
  @@index([referenceId])
  @@index([warehouseId, woodTypeId, thickness])
}

enum AdjustmentReason {
  DAMAGED
  LOST
  FOUND_EXTRA
  COUNTING_ERROR
  OTHER
}

enum MovementType {
  RECEIPT_SYNC
  TRANSFER_OUT
  TRANSFER_IN
  DRYING_START
  DRYING_END
  MANUAL_ADJUSTMENT
}

enum ReferenceType {
  RECEIPT
  TRANSFER
  DRYING_PROCESS
  STOCK_ADJUSTMENT
}

enum TransferStatus {
  PENDING
  APPROVED
  REJECTED
  IN_TRANSIT
  COMPLETED
}

enum UserRole {
  USER
  ADMIN
  VIEWER
  WAREHOUSE_STAFF
  WAREHOUSE_MANAGER
  SUPERVISOR
}

enum WarehouseStatus {
  ACTIVE
  ARCHIVED
}

enum WoodStatus {
  NOT_DRIED
  UNDER_DRYING
  DRIED
  DAMAGED
}
